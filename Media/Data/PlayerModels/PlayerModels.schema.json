{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "title": "Definition of player models. The definitions in these files are loaded one after another in order as defined per the `index.json` file. If an object uses an id that has already been declared, non-empty properties of the object will replace previously loaded data. This can be useful for renaming models, appending extra assets or replacing entire skin files.",
  "allOf": [{ "$ref": "#/$defs/base_object" }],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "Version": {
      "type": "integer",
      "title": "Version of the player models sheet file.",
      "const": 1
    },
    "Description": {
      "type": "string",
      "title": "Additional description of the contents of this player models sheet."
    },
    "Models": {
      "type": "array",
      "title": "A list of player models to load upon the server start.",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/player_model"
      }
    },
    "Overlays": {
      "type": "array",
      "title": "A list of overlay models - models, which share a base skin with a parent defined in the `Models` field.",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/overlay"
      }
    },
    "SkinCategories": {
      "type": "array",
      "title": "A list of skin categories. Skin categories are used to provide separate skin selection for specific use cases, for example separate Blue and Red team skins for the same model.",
      "items": {
        "type": "object",
        "title": "Defined skin category",
        "allOf": [{ "$ref": "#/$defs/base_object" }],
        "unevaluatedProperties": false
      }
    },
    "Skins": {
      "type": "array",
      "title": "A list of skins applicable to the base player models and the overlays that extend them.",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/skin"
      }
    }
  },
  "required": ["$schema", "Version", "Id", "Name"],
  "unevaluatedProperties": false,
  "$defs": {
    "id": {
      "type": "string",
      "title": "Unique and namespaced, alphanumeric identifier. If the identifier already exists, properties will merge and replace into the originally defined object.",
      "pattern": "^[a-z0-9_]+:[a-z0-9_]+$"
    },
    "id_extends": {
      "type": "string",
      "title": "Identifier of the base model this object applies to. If a base model with the specified identifier is not found, the object will be ignored and will not load.",
      "pattern": "^[a-z0-9_]+:[a-z0-9_]+$"
    },
    "name": {
      "type": "string",
      "title": "Name of the object, used for display purposes."
    },
    "assets": {
      "type": "object",
      "title": "A dictionary of optional assets tied to the object, used for display purposes. The keys and value types depend on their implementation inside the title pack. It can contain paths to images, custom displayed text or anything else.",
      "minProperties": 1,
      "additionalProperties": {
        "anyOf": [
          { "type": "string" },
          { "type": "number" },
          { "type": "boolean" }
        ]
      }
    },
    "archetype": {
      "type": "string",
      "title": "Regardless of what a player model tries to be, it must extend an already existing archetype.",
      "enum": [
        "ArenaPlayer",
        "Minion",
        "CanyonCar",
        "StadiumCar",
        "ValleyCar",
        "LagoonCar",
        "IslandCar",
        "BayCar",
        "CoastCar",
        "DesertCar",
        "SnowCar",
        "RallyCar",
        "TrafficCar"
      ]
    },
    "item_path": {
      "type": "string",
      "title": "Path to the player model item file to load. The item must use the same base skin (or utilize the same UV maps) as the parent model.",
      "pattern": ".+\\.[Ii][Tt][Ee][Mm]\\.[Gg][Bb][Xx]$"
    },
    "author": {
      "type": "string",
      "title": "Author of a 3D model or 2D skin."
    },
    "rarity": {
      "type": "integer",
      "title": "Rarity of the object.",
      "minimum": 1,
      "maximum": 5
    },
    "base_object": {
      "type": "object",
      "properties": {
        "Id": { "$ref": "#/$defs/id" },
        "Name": { "$ref": "#/$defs/name" },
        "Assets": { "$ref": "#/$defs/assets" }
      },
      "required": ["Id"]
    },
    "player_model": {
      "type": "object",
      "title": "Defines a usable player model. If the model only extends an archetype with minor gameplay tweaks, without changing the visuals, prefer using an overlay instead to preserve the custom skin selection.",
      "allOf": [{ "$ref": "#/$defs/base_object" }],
      "properties": {
        "Archetype": { "$ref": "#/$defs/archetype" },
        "ItemPath": { "$ref": "#/$defs/item_path" },
        "LoadAs": {
          "type": "string",
          "title": "Describes in what ways the model will be loaded. For `ItemAndArchetype`, applied model will depend on the player's Stadium unlock status and the model overlay to preserve player's regular skins.",
          "enum": ["Item", "ItemAndArchetype", "Archetype"]
        },
        "SkinDirectories": {
          "type": "array",
          "title": "Defines a subdirectory of Models or Vehicles folder, from which the user's own skins will be fetched.",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "Author": { "$ref": "#/$defs/author" }
      },
      "unevaluatedProperties": false
    },
    "overlay": {
      "type": "object",
      "title": "Defined usable overlay. It is treated on the same level as a model in terms of selection and gameplay.",
      "allOf": [{ "$ref": "#/$defs/base_object" }],
      "properties": {
        "Extends": { "$ref": "#/$defs/id_extends" },
        "ItemPath": { "$ref": "#/$defs/item_path" },
        "Gameplay": { "$ref": "#/$defs/gameplay" }
      },
      "unevaluatedProperties": false
    },
    "skin": {
      "type": "object",
      "title": "Defines a model skin, which will be applied to a player model.",
      "allOf": [{ "$ref": "#/$defs/base_object" }],
      "properties": {
        "AppliesTo": {
          "oneOf": [
            { "$ref": "#/$defs/id_extends" },
            {
              "type": "string",
              "title": "Using the wildcard identifier `*` will consider this skin to be applicable to all player models. This can be used if the skin has a custom model and is supposed to work like inside the CarCommon folder.",
              "const": "*"
            }
          ]
        },
        "SkinPath": {
          "type": "string",
          "title": "Path to the skin file to load. Its diffuse texture must use the same UV maps as the base skin in the parent model."
        },
        "Author": { "$ref": "#/$defs/author" },
        "Rarity": { "$ref": "#/$defs/rarity" },
        "IsHidden": {
          "type": "boolean",
          "title": "If set to true, the implementation of the skin selection interface can conisder this skin to be hidden."
        },
        "SortIndex": {
          "type": "integer",
          "title": "Defines the order in which the skins are displayed in the skin selection interface.",
          "default": 0
        }
      },
      "unevaluatedProperties": false
    },
    "gameplay": {
      "type": "object",
      "title": "Defines read-only handling values of a TrackMania vehicle, for display purposes only.",
      "properties": {
        "AccelCoef": { "type": "number" },
        "ControlCoef": { "type": "number" },
        "GravityCoef": { "type": "number" }
      },
      "required": ["AccelCoef", "ControlCoef", "GravityCoef"],
      "unevaluatedProperties": false
    }
  }
}
